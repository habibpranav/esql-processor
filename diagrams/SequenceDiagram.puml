@startuml
autonumber

actor User
participant Main
participant EMFParser as Parser
participant EMFQuery as Query
participant DatabaseFetcher as DB
participant EMFEngine as Engine

User -> Main : Run Program\n(EsqlQuery1.txt)
Main -> Main : Read ESQL input file

Main -> Parser : parse(rawQuery)
Parser -> Parser : normalize input
Parser -> Parser : extractSections()
Parser -> Parser : parse SELECT / FROM / WHERE / GROUP BY / GVs / HAVING
Parser -> Query : build EMFQuery object
Parser --> Main : return EMFQuery

Main -> DB : connect()
DB --> Main : Connection

Main -> DB : fetchAllRows(conn)
DB --> Main : List<Row>

Main -> Engine : execute(Query, rows)
Engine -> Engine : build mf_struct (scan 0)
Engine -> Engine : run scans 1..n\n(update aggregates)
Engine -> Engine : apply HAVING
Engine --> Main : final result rows

Main -> User : print formatted output

@enduml